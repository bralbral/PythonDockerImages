name: Publish "pip download -r *.txt" as artifacts

on:
  push:
    branches: [ main ]

jobs:
  archive-build-artifacts:
    strategy:
      matrix:
        platform: [ ubuntu-latest, windows-latest ]
        python-version: ['3.9.2']

    runs-on: ${{ matrix.platform }}
    steps:

      - name: ${{ matrix.platform }}  ${{ matrix.python-version }} Get Root project folder
        uses: actions/checkout@v2.3.4

      - uses: actions/setup-python@v4
        with:
          python-version:  ${{ matrix.python-version }}
          architecture: 'x64'

      - name: ${{ matrix.platform }}  ${{ matrix.python-version }} Create a temporary artifacts folder
        run: mkdir downloads

      - name: ${{ matrix.platform }}  ${{ matrix.python-version }} Add artifacts to folder
        run: | 
            cd downloads
            pip download -r ../prefect_requirements.txt
            cd ..

      - name: ${{ matrix.platform }}  ${{ matrix.python-version }} Upload artifacts folder
        uses: actions/upload-artifact@v2
        with:
          name: ${{ matrix.platform }}-${{ matrix.python-version }}-artifacts
          path: downloads
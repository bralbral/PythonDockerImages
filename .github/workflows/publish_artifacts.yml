name: Publish "pip download -r *.txt" as artifacts

on:
  push:
    branches: [ main ]

jobs:
  archive-build-artifacts:
    strategy:
      matrix:
        platform: [ ubuntu-latest, windows-latest ]
        python-version: ['3.10.9']
        project_type: ['prefect', 'fastapi', 'prefect_2.0']
        architecture: ['x64']

    runs-on: ${{ matrix.platform }}
    steps:

      - name: Get Root project folder
        uses: actions/checkout@v2.3.4

      - uses: actions/setup-python@v4
        with:
          python-version:  ${{ matrix.python-version }}
          architecture: ${{ matrix.architecture }}

      - name: Create a temporary artifacts folder
        run: mkdir downloads

      - name: Add artifacts to folder
        run: | 
            cd downloads
            pip download -r ../${{ matrix.project_type }}_requirements.txt
            cd ..

      - name: Upload artifacts folder
        uses: actions/upload-artifact@v2
        with:
          name: ${{ matrix.platform }}_${{ matrix.python-version }}_${{ matrix.architecture }}_${{ matrix.project_type }}_artifacts
          path: downloads